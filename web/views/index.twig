{% extends "layout.html" %}

{% block content %}
<div class="container">
  <div class="page-header">
    <h1>Covering Matrix Plotter</h1>
    <span>Plot covering matrix topology on google maps using a topology description json file</span>
  </div>
  <div class="row">
    <div class="col-md-12">
      <h3><span class="glyphicon glyphicon-info-sign"></span> How to use this tool?</h3>
      <ul>
        <li>Load your json topology file.</li>
        <li>That's it. You can load your finished topology too.
      </ul>
      <div>
        <label class="control-label">Select File</label>
        <input id="input-1" name="input1[]" type="file" class="file file-loading" data-allowed-file-extensions='["json"]' data-show-preview="false" data-show-upload="false">
      </div>
    </div>
    <div class="col-md-12">
      <h3><span class="glyphicon glyphicon-link"></span> Topology Loaded </h3>
      <div>

        <h3 id="topology-name"> &lt;Topology Name&gt; </h3> 

        <div id="map"> PUT A MAP HERE! </div>

      </div>
      <script>
        $("#input-1").on('fileloaded', function(event, file, previewId, index, reader) {
          console.log('File loaded triggered');
          console.log('Topology File Loaded');

          reader.onload = function(e) {
            var topology = JSON.parse(reader.result);
            window.test_topology = topology;
            console.log(reader.result);

            if(topology === null || topology.topologyName === ""){
              alert("Not a topology file!");
              return;
            }

            var topologyNameDom = document.getElementById("topology-name");
            topologyNameDom.innerText = topology.topologyName;

            // ADD MAP MARKS

          };

          reader.readAsText(file);  
        });
        $("#input-1").on('fileclear', function(event) {
          console.log("File removed");

          var topologyNameDom = document.getElementById("topology-name");
          topologyNameDom.innerText = "<Topology Name>";

          // REMOVE MAP MARKS

        });

        function initMap() {
          var salvador = {lat: -13.002418, lng: -38.5102597};
          
          var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 12,
            center: salvador
          });

          var marker = new google.maps.Marker({
            position: salvador,
            map: map
          });
        }
      </script>
      <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB4_217fZrVD4vV2fuLw3P4S7wVVAFLBiA&callback=initMap"></script>
    </div>
  </div> <!-- row -->
   <div class="alert alert-info text-center" style="margin-top: 20px;" role="alert">
    This is an work in progress project, be advised that it may contains bugs or small errors. Thanks for your understanding!
  </div>
</div>

{% endblock %}
